# Audio Scheduler VM
[![Travis CI](https://img.shields.io/travis/danigb/ash-vm/master.svg)](https://travis-ci.org/danigb/ash-vm)
[![Codecov](https://img.shields.io/codecov/c/github/danigb/ash-vm/master.svg)](https://codecov.io/gh/danigb/ash-vm)
[![CDNJS](https://img.shields.io/cdnjs/v/ash-vm.svg?colorB=ff69b4)](https://cdnjs.com/libraries/ash-vm)
[![npm](https://img.shields.io/npm/v/ash-vm.svg?colorB=ff69b4)](https://www.npmjs.org/package/ash-vm)


> `asm-vm` is a light-weight virtual machine that executes a very simple language, that captures some essential concepts for a musical live coding context, such as playing notes and looping patterns. It is intentionally limited to make it fairly easy to learn, yet also intentionally designed to make it possible to express a wide variety of ideas. It is not designed to be succinct -- it's supposed to be generated by other program.

[Continue reading](https://danigb.github.io/ash-vm/)

Idea and code by @grrrwaaa, extracted from:
https://worldmaking.github.io/workshop_nime_2017/vm.html

Currently it works with the aswesome [Gibberish](https://github.com/charlieroberts/Gibberish) by @charlieroberts

Kudos for both!

## Usage

Browser (8kb minified):

```html
<script src="https://danigb.github.io/ash-vm/js/gibberish.min.js"></script>
<script src="https://danigb.github.io/ash-vm/dist/ash-vm.js"></script>
<script>
const vm = AshVM.init(Gibberish)
vm.run(["@loop", [440, "freq", "@set", "@pluck", 0.5, "@wait"]])
</script>
```

ES6:

```js
// ES6
import Gibberish from "gibberish-dsp"
import { init } from "ash-vm"

const vm = init(Gibberish)
vm.run(["@loop", [440, "freq", "@set", "@pluck", 0.5, "@wait"]])
```

ES5:


```js
const Gibberish = require("gibberish-dsp")
const init = require("ash-vm").init
const vm = init(Gibberish)

vm.run(["@loop", ["@kick", 0.5, "@wait", "@snare", 0.5, "@wait"]])
```

## Install

Via npm: `npm i -S ash-vm` or with yarn: `yarn add ash-vm`

Not yet published.

## API

#### `init(Gibberish)` â†’ vm

The init function receives an audio driver (currently only Gibberish) and returns a virtual machine:

```js
const Gibberish = require("gibberish-dsp")
const init = require("ash-vm").init
const vm = init(Gibberish)
```

#### `vm.run(program, sync = true)`

Run a program. If `sync` is true, the program will start in the next beat.

```js
const notes = [60, 62, 64, 78, 98, 100]
vm.run(["@loop", ["@pick", notes, "@mtof", "freq", "@set", "@pluck"]])
```

#### `vm.addCommands(commands)`

You can extend the instruction set by adding commands. You can, for example, add more instruments:

```js
const bang = new Gibberish.FMSynth({ cmRatio:5, index:3 }).connect()
vm.addCommands({
  "@bang!": ({ context }) => bang.note(context.get("freq"))
})

vm.run(["@loop", ["@bang!", 1, "@wait"]])
```

## Demos, docs and source code

- An introduction to AshVM (by @grrrwaaa and @charlieroberts): https://danigb.github.io/ash-vm/
- Annotated source code: https://danigb.github.io/ash-vm/literate/

## Develop

You need node and npm installed. [Yarn](https://yarnpkg.com/en/docs/install) recommended.

1. Clone this repo
2. Install dependencies: `npm i` or `yarn`
3. Run tests: `npm test`
4. Contribute
